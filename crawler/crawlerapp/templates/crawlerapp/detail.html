{% extends '../base.html' %} {% block title %}Job {{ job_name }}{% endblock %}{% block content %}
<div class="container">
  <center>

    <div class="row">
      <div class="col s6">
        <h4>Job data for job {{ job_name }}</h4>
        <table>
          <thead>
            <tr>
              <th>Data</th>
              <th>Value</th>
            </tr>
          </thead>

          <tbody>
            <tr>
              <td>Job Name</td>
              <td>{{ job_name }}</td>
            </tr>
            <tr>
              <td>Job ID</td>
              <td>{{ job_id }}</td>
            </tr>
            <tr>
              <td>Number of videos crawled</td>
              <td id="num_vids">{{ job_num_vids }}</td>
            </tr>
            <tr>
              <td>Number of videos downloaded</td>
              <td id="downloaded">{{ num_downloaded }}</td>
            </tr>
            <tr>
              <td>Number of filtered (passed) videos</td>
              <td id="job_num_filtered_videos">{{ job_num_filtered_videos }}</td>
            </tr>
            <tr>
              <td>Applied Filters (Logical OR'd)</td>
              <td id="applied_filters">{{ job_applied_filters }}</td>
            </tr>
            <tr>
              <td>Query</td>
              <td>{{ job_query }}</td>
            </tr>
            <tr>
              <td>Time of job creation</td>
              <td>{{ job_created_date }}</td>
            </tr>
            <tr>
              <td>Finished Crawl</td>
              <td id="executed">{{ executed }}</td>
            </tr>
            <tr>
              <td>Finished downloading</td>
              <td id="download_finished">{{ download_finished }}</td>
            </tr>
            <tr>
              <td>Active Filters</td>
              <td id="active_filters">{{ active_filters }}</td>
            </tr>
            <tr>
              <td>Number of videos with frames extracted</td>
              <td id="num_frames_extracted">{{ num_frames_extracted }}</td>
            </tr>
            <tr>
              <td>Number of videos with faces detected</td>
              <td id="num_face_detected">{{ num_face_detected }}</td>
            </tr>
            <tr>
              <td>Number of videos that passed scene change filter</td>
              <td id="num_scene_change_passed">{{ num_scene_change_passed }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="col s6">
        <h4>Actions</h4>
        <form id='form-id' method="post">
          {% csrf_token %}
          <!--
           {% if executed == False or download_started == True %}
          <button class="btn-large disabled">Download</button> {% else %}
          <button class="btn-large waves-effect waves-light" type="submit" value="download" name="download">Download</button> {% endif %}-->
          <center>
            {% for filter, index, enabled in filters %}
            <div class="row">
              <div class="col s12">
                <div class="card blue-grey darken-1">
                  <div class="card-content white-text">
                    <span class="card-title">{{ filter.name }}</span>
                    <p>{{ filter.description }}</p>
                  </div>
                  <div class="card-action">
                    {% if download_finished == True and enabled == True %}
                    <button id="{{ filter }}" class="btn waves-effect waves-light" type="submit" value="{{ index }}" name="filter">Run Filter</button> {% else %}
                    <button id="{{ filter }}" class="btn waves-effect waves-light disabled" type="submit" value="{{ index }}" name="filter">Run Filter</button> {% endif %}
                    <button class="btn waves-effect waves-light" type="submit" value="{{ index }}" name="remove">Clear this Filter</button>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </center>

        </form>
      </div>
    </div>
  </center>
</div>
<script>
  window.onload = function() {
    updateProgress("{% url 'update-progress' 12345 %}".replace(/12345/, "{{ job_id }}"))
  };

  function updateProgress(progressUrl) {
    fetch(progressUrl).then(function(response) {
      response.json().then(function(data) {
        // update the appropriate UI components
        for (var key in data) {
          if (key == "job") {
            for (var k in data.job) {
              document.getElementById(k).innerHTML = data.job[k]
            }
          } else if (key == "filters") {
              for (var k in data[key]) {
                if (k[1]) {
                  document.getElementById(k[0]).className = "btn waves-effect waves-light";
                } else {
                  document.getElementById(k[0]).className = "btn waves-effect waves-light disabled";
                }
              }
          } else {
            document.getElementById(key).innerHTML = data[key]
          }
        }
        setTimeout(updateProgress, 3000, progressUrl);
      });
    });
  }
</script>
{% endblock %}
